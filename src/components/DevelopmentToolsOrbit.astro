---
/**
 * DevelopmentToolsOrbit Component
 *
 * Componente de visualización orbital de herramientas de desarrollo.
 * Muestra las herramientas en anillos concéntricos rotatorios con efecto radar.
 *
 * Estructura de carpetas esperada:
 * - /public/icon/tools/anillo-0/ (herramientas más usadas - anillo más externo)
 * - /public/icon/tools/anillo-1/ (anillo medio-externo)
 * - /public/icon/tools/anillo-2/ (anillo medio-interno)
 * - /public/icon/tools/anillo-3/ (herramientas menos usadas - anillo más interno)
 * - /public/icon/tools/anillo-4/ (anillo central - opcional)
 */

// ==================== INTERFACES ====================

interface Tool {
  name: string;    // Nombre legible de la herramienta (ej: "Node Js")
  icon: string;    // Ruta del icono relativo a public (ej: "/icon/tools/anillo-0/nodejs.svg")
}

interface RingConfig {
  index: number;          // Índice del anillo (0-4)
  translateDistance: string; // Distancia de traslación desde el centro (ej: "12.5em")
  width: string;          // Ancho del anillo (ej: "25em")
  height: string;         // Alto del anillo (ej: "25em")
  animationDuration: string; // Duración de la animación de rotación (ej: "35s")
}

// ==================== CONSTANTES ====================

// Configuración de cada anillo: tamaño, distancia y velocidad de rotación
const RING_CONFIGS: RingConfig[] = [
  { index: 0, translateDistance: "12.5em", width: "25em", height: "25em", animationDuration: "35s" },
  { index: 1, translateDistance: "10em",   width: "20em", height: "20em", animationDuration: "30s" },
  { index: 2, translateDistance: "7.5em",  width: "15em", height: "15em", animationDuration: "25s" },
  { index: 3, translateDistance: "5em",    width: "10em", height: "10em", animationDuration: "20s" },
];

// Ángulo inicial y final para el semicírculo inferior (180° = izquierda, 360° = derecha)
const SEMICIRCLE_START_ANGLE = 180;
const SEMICIRCLE_TOTAL_ANGLE = 180;

// ==================== FUNCIONES HELPER ====================

/**
 * Obtiene todos los archivos SVG de una carpeta específica en /public/icon/tools/
 * @param folderPath - Nombre de la carpeta (ej: "/anillo-0/")
 * @returns Array de objetos Tool con nombre e icono
 */
const getIconsFromFolder = (folderPath: string): Tool[] => {
  // Importación glob de Astro: obtiene todos los SVG de forma estática en build time
  const allSvgFiles = import.meta.glob("/public/icon/tools/**/*.svg", { eager: true });

  // Filtrar solo los archivos de la carpeta específica y mapear a objetos Tool
  return Object.keys(allSvgFiles)
    .filter((path) => path.includes(folderPath))
    .map((path) => {
      // Extraer nombre del archivo sin extensión (ej: "nodejs.svg" -> "nodejs")
      const fileName = path.split("/").pop()?.replace(".svg", "") || "";

      // Convertir nombre de archivo a formato legible
      // Ejemplo: "nodejs" -> "Nodejs", "after-effects" -> "After Effects"
      const toolName = fileName
        .split("-")
        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
        .join(" ");

      // Convertir ruta absoluta a ruta relativa desde public/
      const iconPath = path.replace("/public", "");

      return { name: toolName, icon: iconPath };
    });
};

/**
 * Calcula el ángulo de posición para un ítem en el semicírculo inferior
 * @param index - Índice del ítem en el array
 * @param totalItems - Cantidad total de ítems en el anillo
 * @returns Ángulo en grados (180° a 360°)
 */
const calculateAngle = (index: number, totalItems: number): number => {
  return SEMICIRCLE_START_ANGLE + index * (SEMICIRCLE_TOTAL_ANGLE / totalItems);
};

// ==================== CARGA DE DATOS ====================

// Obtener iconos para cada anillo desde el sistema de archivos
const ringIcons = RING_CONFIGS.map((config) =>
  getIconsFromFolder(`/anillo-${config.index}/`)
);
---

<!-- ==================== TEMPLATE HTML ==================== -->

<!-- Sección principal: Contenedor de la visualización orbital -->
<section class="tools-section w-full py-12">
  <div class="container mx-auto px-4">
    <!-- Título de la sección -->
    <h2 class="text-3xl font-bold mb-4 text-white">
      Mis Herramientas de Desarrollo
    </h2>

    <!-- Contenedor del sistema orbital -->
    <div class="orbit-container flex justify-center items-center">
      <div class="orbit">
        <ul class="orbit-wrap">
          <!-- ========== CENTRO DEL ORBIT ========== -->
          <!-- Círculo central con ícono de código -->
          <li class="orbit-center">
            <div class="orbit-center__icon">
              <!-- Ícono SVG de código (símbolos < > ) -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="code-icon"
              >
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
              </svg>

              <!-- Puntos decorativos animados alrededor del centro -->
              <div class="center-dots">
                <div class="dot dot-1"></div>
                <div class="dot dot-2"></div>
                <div class="dot dot-3"></div>
              </div>
            </div>
          </li>

          <!-- ========== EFECTOS RADAR ========== -->
          <!-- Línea de radar rotatoria (simula escaneo) -->
          <div class="radar-line"></div>

          <!-- Línea horizontal base del semicírculo -->
          <div class="radar-bottom-line"></div>

          <!-- ========== ANILLOS DE HERRAMIENTAS ========== -->
          <!-- Generación dinámica de cada anillo con sus herramientas -->
          {
            RING_CONFIGS.map((config, ringIndex) => {
              const icons = ringIcons[ringIndex];

              // Solo renderizar si hay iconos en este anillo
              if (icons.length === 0) return null;

              return (
                <li>
                  {/* Anillo con clase dinámica (ring-0, ring-1, etc.) */}
                  <ul
                    class={`ring-${config.index}`}
                    data-ring-index={config.index}
                  >
                    {/* Renderizar cada herramienta en el anillo */}
                    {icons.map((tool, toolIndex) => {
                      // Calcular posición angular en el semicírculo inferior
                      const angle = calculateAngle(toolIndex, icons.length);

                      return (
                        <li
                          style={`transform: rotate(${angle}deg) translate(${config.translateDistance}) rotate(-${angle}deg)`}
                        >
                          <div class="orbit-icon-wrapper" title={tool.name}>
                            {/* Ícono de la herramienta */}
                            <img
                              src={tool.icon}
                              alt={tool.name}
                              class="orbit-icon"
                              loading="lazy"
                            />
                            {/* Tooltip con el nombre de la herramienta */}
                            <span class="tool-name">{tool.name}</span>
                          </div>
                        </li>
                      );
                    })}
                  </ul>
                </li>
              );
            })
          }
        </ul>
      </div>
    </div>
  </div>
</section>

<style>
  /* ==================== VARIABLES CSS ==================== */
  :root {
    /* Colores del tema */
    --orbit-primary-color: rgba(56, 189, 248, 0.8);
    --orbit-primary-glow: rgba(56, 189, 248, 0.3);
    --orbit-border-color: rgba(56, 189, 248, 0.3);
    --orbit-background: rgba(10, 20, 30, 0.1);
    --icon-background: #2a2a2a;
    --icon-hover-background: #3182ce;

    /* Z-index layers */
    --z-radar: 100;
    --z-icons: 60;
    --z-center: 55;
    --z-radar-base: 40;
    --z-tooltip: 10;

    /* Timing */
    --transition-speed: 300ms;
    --hover-scale: 1.2;
  }

  /* ==================== LAYOUT PRINCIPAL ==================== */

  /* Contenedor de la sección completa */
  .tools-section {
    position: relative;
    overflow: hidden;
  }

  /* Contenedor del sistema orbital */
  .orbit-container {
    position: relative;
    width: 100%;
    height: auto;
    min-height: 15em;
  }

  /* Elemento orbit principal */
  .orbit {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Alinea arriba para mostrar semicírculo inferior */
  }

  /* Wrapper del sistema de anillos */
  .orbit-wrap {
    height: 15em;
    list-style: none;
    font-size: 1.6em;
    position: relative;
    width: 50em;
    margin: 0 auto;
    overflow: hidden; /* Oculta la mitad superior del círculo */
  }

  /* Posicionamiento de elementos hijos directos */
  .orbit-wrap > li {
    position: absolute;
    left: 50%;
    top: 0%;
    transform: translate(-50%, -50%);
  }

  /* ==================== ICONOS DE HERRAMIENTAS ==================== */

  /* Wrapper de cada ícono individual */
  .orbit-icon-wrapper {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Estilo base de los iconos */
  .orbit-icon {
    width: 2.2em;
    height: 2.2em;
    padding: 0.3em;
    border-radius: 50%;
    background: var(--icon-background);
    display: block;
    transition: all var(--transition-speed) ease-in-out;
    z-index: var(--z-icons);
  }

  /* Tooltip con nombre de herramienta (visible al hover) */
  .tool-name {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.2em 0.5em;
    border-radius: 0.3em;
    font-size: 0.7em;
    white-space: nowrap;
    opacity: 0;
    transition: opacity var(--transition-speed) ease;
    pointer-events: none;
    margin-top: 0.5em;
    z-index: var(--z-tooltip);
  }

  /* Estados hover de iconos */
  .orbit-icon-wrapper:hover .tool-name {
    opacity: 1;
  }

  .orbit-icon-wrapper:hover .orbit-icon {
    transform: scale(var(--hover-scale));
    background: var(--icon-hover-background);
  }

  /* ==================== EFECTOS RADAR ==================== */

  /* Línea de radar rotatoria (simula escaneo) */
  .radar-line {
    position: absolute;
    top: 0%;
    left: 50%;
    width: 15em;
    height: 1px;
    background: linear-gradient(
      to right,
      transparent,
      var(--orbit-primary-color)
    );
    transform-origin: left;
    z-index: var(--z-radar);
    animation: radar-scan 10s linear infinite;
  }

  /* Línea horizontal base del semicírculo */
  .radar-bottom-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background: linear-gradient(
      to right,
      transparent,
      rgba(71, 85, 105, 0.7),
      transparent
    );
    z-index: var(--z-radar-base);
  }

  /* Animación de escaneo del radar */
  @keyframes radar-scan {
    0%,
    100% {
      transform: rotate(0deg);
    }
    50% {
      transform: rotate(360deg);
    }
  }

  /* ==================== ANILLOS (RINGS) ==================== */

  /* Estilo base compartido por todos los anillos */
  ul[class^="ring"] {
    border: solid 1px var(--orbit-border-color);
    position: relative;
    padding: 0;
    border-radius: 50%;
    list-style: none;
    box-sizing: content-box;
    background: var(--orbit-background);
    box-shadow: 0 0 20px var(--orbit-primary-glow) inset;
    transition: all var(--transition-speed) ease-in-out;
  }

  /* Estilo de ítems dentro de los anillos */
  ul[class^="ring"] li {
    display: block;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2.2em;
    height: 2.2em;
    margin: -1.1em; /* Centra el elemento (mitad de width/height) */
    transition: all var(--transition-speed) ease-in-out;
  }

  /* ========== CONFIGURACIÓN ESPECÍFICA DE CADA ANILLO ========== */

  /* Anillo 0 - Más externo (herramientas más usadas) */
  .ring-0 {
    width: 25em;
    height: 25em;
    animation: clockwiseRotate 35s linear infinite;
  }

  .ring-0 .orbit-icon-wrapper {
    animation: counterClockwiseRotate 35s linear infinite;
  }

  /* Anillo 1 - Medio-externo */
  .ring-1 {
    width: 20em;
    height: 20em;
    animation: clockwiseRotate 30s linear infinite;
  }

  .ring-1 .orbit-icon-wrapper {
    animation: counterClockwiseRotate 30s linear infinite;
  }

  /* Anillo 2 - Medio-interno */
  .ring-2 {
    width: 15em;
    height: 15em;
    animation: clockwiseRotate 25s linear infinite;
  }

  .ring-2 .orbit-icon-wrapper {
    animation: counterClockwiseRotate 25s linear infinite;
  }

  /* Anillo 3 - Más interno (herramientas menos usadas) */
  .ring-3 {
    width: 10em;
    height: 10em;
    animation: clockwiseRotate 20s linear infinite;
  }

  .ring-3 .orbit-icon-wrapper {
    animation: counterClockwiseRotate 20s linear infinite;
  }

  /* ==================== EFECTOS DE HOVER EN ANILLOS ==================== */

  /* Al hacer hover sobre un anillo, resaltarlo */
  .orbit-wrap > li:hover ul {
    border-width: 2px;
    border-color: var(--orbit-primary-color);
  }

  /* Atenuar anillos hermanos cuando se hace hover en uno */
  .orbit-wrap > li:hover ~ li ul {
    border-color: rgba(255, 255, 255, 0.2);
  }

  .orbit-wrap > li:hover ~ li ul li {
    opacity: 0.4;
  }

  /* ==================== CENTRO ORBITAL ==================== */

  /* Círculo central con gradiente */
  .orbit-center {
    z-index: var(--z-center);
    font-size: 2em;
    width: 2em;
    height: 2em;
    line-height: 2em;
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 2px solid rgba(56, 189, 248, 0.4);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    box-shadow:
      0 0 20px rgba(56, 189, 248, 0.5),
      0 0 40px rgba(56, 189, 248, 0.2),
      inset 0 0 20px rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: visible;
    transform: translateY(30%); /* Posiciona en la base del semicírculo */
  }

  /* Wrapper del ícono central */
  .orbit-center__icon {
    position: relative;
    transition: all 400ms ease-in-out;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Efecto de escalado al hover en el centro */
  .orbit-center:hover .orbit-center__icon {
    transform: scale(1.1);
  }

  /* Ícono de código con efecto de pulso */
  .code-icon {
    animation: pulse 2s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 8px var(--orbit-primary-glow));
  }

  /* Contenedor de puntos decorativos */
  .center-dots {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  /* Puntos decorativos animados alrededor del centro */
  .dot {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--orbit-primary-color);
    border-radius: 50%;
    animation: orbit-dots 3s linear infinite;
  }

  /* Posicionamiento individual de cada punto */
  .dot-1 {
    top: 10%;
    right: 20%;
    animation-delay: 0s;
  }

  .dot-2 {
    bottom: 15%;
    left: 15%;
    animation-delay: 1s;
  }

  .dot-3 {
    top: 50%;
    left: 5%;
    animation-delay: 2s;
  }

  /* ==================== ANIMACIONES ==================== */

  /* Pulso del ícono central */
  @keyframes pulse {
    0% {
      opacity: 0.8;
      transform: scale(1);
    }
    100% {
      opacity: 1;
      transform: scale(1.05);
    }
  }

  /* Animación de los puntos decorativos */
  @keyframes orbit-dots {
    0%,
    50% {
      opacity: 0.3;
      transform: scale(0.8);
    }
    25% {
      opacity: 1;
      transform: scale(1.2);
    }
  }

  /* Rotación en sentido horario para los anillos */
  @keyframes clockwiseRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Rotación contrahoraria para los iconos (mantiene orientación) */
  @keyframes counterClockwiseRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(-360deg);
    }
  }

  /* ==================== RESPONSIVE DESIGN ==================== */
  /*
   * El tamaño del orbit se ajusta mediante font-size para mantener proporciones.
   * Todas las medidas en 'em' escalan proporcionalmente.
   */

  /* Pantallas ultra grandes (4K+) - 3600px+ */
  @media (min-width: 3600px) {
    .orbit-wrap {
      font-size: 2em;
    }
  }

  /* Pantallas grandes (Desktop HD) - 1400px-1799px */
  @media (min-width: 1400px) and (max-width: 1799px) {
    .orbit-wrap {
      font-size: 1.8em;
    }
  }

  /* Pantallas medianas-grandes (Laptop HD) - 1200px-1399px */
  @media (min-width: 1200px) and (max-width: 1399px) {
    .orbit-wrap {
      font-size: 1.7em;
    }
  }

  /* Laptops estándar - 992px-1199px */
  @media (min-width: 992px) and (max-width: 1199px) {
    .orbit-wrap {
      font-size: 1.6em;
    }
  }

  /* Tablets horizontales - 768px-991px */
  @media (min-width: 768px) and (max-width: 991px) {
    .orbit-wrap {
      font-size: 1.4em;
    }
  }

  /* Tablets verticales - 576px-767px */
  @media (min-width: 576px) and (max-width: 767px) {
    .orbit-wrap {
      font-size: 1.2em;
    }
  }

  /* Móviles - <575px */
  @media (max-width: 575px) {
    .orbit-wrap {
      font-size: 1em;
    }
  }
</style>
